马超集中陇右的全部兵力，张鲁又派大将杨昂协助马超，大约万余人攻城。